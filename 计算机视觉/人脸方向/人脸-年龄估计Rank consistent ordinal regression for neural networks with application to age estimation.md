# Rank consistent ordinal regression for neural networks with application to age estimation

[**相关链接**](#相关链接)  
[**0.摘要 Abstract**](#0.摘要Abstract)  
[**1.介绍 Introduction**](#1.介绍Introduction)  
[**2.相关工作 Related work**](#2.相关工作Relatedwork)  
[**3.网络结构**](#3.网络结构)  
[**4.实验 Experiments**](#4.实验Experiments)  
[**5.结论 Conclusion**](#5.结论Conclusion)  



## 相关链接
参考博文链接：  
参考视频链接：  
源码链接：  
论文链接：  https://arxiv.org/pdf/1901.07884v7.pdf

<a id="0.摘要Abstract"></a>
## 0.摘要 Abstract
在许多实际的预测任务中，类别标签包含有关标签之间相对顺序的信息，而这些信息无法通过常用的损失函数（如多类别交叉熵）捕捉到。最近，深度学习社区采用了序数回归框架来考虑这种顺序信息。神经网络通过将序数目标转化为二分类子任务来具备序数回归能力。然而，这种方法在不同的二分类器之间存在一致性问题。为了解决这些不一致性，我们提出了具有强有力的理论保证（对于秩单调性和一致的置信度得分）的COnsistent RAnk Logits（CORAL）框架。此外，所提出的方法与网络架构无关，并且可以扩展任意先进的深度神经网络分类器以用于序数回归任务。在面部图像年龄预测的一系列数据集上对所提出的秩一致方法进行的实证评估显示，与参考的序数回归网络相比，预测误差显著减少。

<a id="1.介绍Introduction"></a>
## 1.介绍 Introduction
序数回归（也称为序数分类）描述了在序数尺度上预测标签的任务。在这里，排名规则或分类器h将每个对象xi∈X映射成一个有序集合h:X→Y，其中Y={r1 ≺...≺rK}。与分类不同，标签提供了足够的信息来排序对象。然而，与度量回归相反，标签值之间的差异是任意的。

虽然机器学习领域已经开发出许多强大的预测建模算法，但大多数算法都是为分类任务设计的。Li和Lin（2007）提出的扩展二元分类方法是许多序数回归实现的基础。然而，基于神经网络的此方法的实现通常会在二元排名之间出现分类器不一致性问题（Niu等人，2016）。这种单独的二元分类器的预测之间不一致的问题在图1中进行了说明。我们提出了一种新的方法和定理，可保证分类器的一致性，并且可以轻松地在各种神经网络架构中实现。

此外，本文还针对使用卷积神经网络（CNNs）结合我们的方法来预测个体年龄的具有挑战性的真实世界数据集，提供了理论上秩一致性保证的实证分析。由于人脸的老化效应因个体年龄不同而异，因此老化可以被视为非平稳过程。在童年期间，面部老化主要与面部形状的改变相关，而在成年期间，老化主要由皮肤纹理的变化定义（Ramanathan等人，2009；Niu等人，2016）。基于这种假设，可以使用基于序数回归的方法来建模年龄预测（Yang等人，2010；Chang等人，2011；Cao等人，2012；Li等人，2012）。

本文的主要贡献如下：

一致秩对数（CORAL）框架用于具有分类器一致性理论保证的序数回归；
实现CORAL以适应常见的CNN架构，如ResNet（He等人，2016），用于序数回归；
对不同年龄估计数据集进行实验，显示CORAL的保证二元分类器一致性相对于参考框架的序数回归具有更好的预测性能。

<a id="2.相关工作Relatedwork"></a>
## 2.相关工作 Related work

<a id="2.1序数回归和排名"></a>
### 2.1 序数回归和排名 Ordinal regression and ranking
过去已经开发了多种广义线性模型的序数回归的多元扩展，其中包括流行的比例几率和比例危害模型（McCullagh，1980）。此外，机器学习领域还基于经过充分研究的分类算法的扩展，通过重新定义问题以利用多个二元分类任务，开发了序数回归模型（Baccianella等人，2009）。在这方面的早期工作包括使用感知机（Crammer和Singer，2002；Shen和Joshi，2005）和支持向量机（Herbrich等人，1999；Shashua和Levin，2003；Rajaram等人，2003；Chu和Keerthi，2005）。Li和Lin（2007）提出了一个通用的规约框架，统一了一些现有算法的观点。

<a id="2.2序数回归的CNN方法"></a>
### 2.2 序数回归的CNN方法 Ordinal regression and ranking
虽然早期使用卷积神经网络（CNNs）进行序数目标的研究采用了传统的分类方法（Levi和Hassner，2015；Rothe等人，2015），但是Li和Lin（2007）提出的将序数回归转化为二元分类的通用规约框架最近被Niu等人（2016）采用，并被称为序数回归CNN（OR-CNN）。在OR-CNN方法中，具有K个等级的序数回归问题被转化为K-1个二元分类问题，其中第k个任务预测人脸图像的年龄标签是否超过第k个等级rk，k=1,...,K−1。所有K-1个任务共享相同的中间层，但在输出层中分配不同的权重参数。

虽然OR-CNN在基准数据集上能够达到最先进的性能，但它并不能保证一致的预测，因此对于个别的二元任务的预测可能会有分歧。例如，在年龄估计设置中，如果第k个二元任务预测一个人的年龄超过30岁，但之前的任务预测该人的年龄不到20岁，这将是矛盾的。当将K-1个任务的预测结果合并以获得估计年龄时，这种不一致可能不是最优的。

Niu等人（2016）认识到分类器的不一致性并非理想，他们还指出确保K-1个二元分类器的一致性会大大增加训练复杂性（Niu等人，2016）。本文提出的CORAL方法解决了以上两个问题，具有分类器一致性的理论保证，并且不增加训练复杂性。

<a id="2.3其他用于年龄估计的CNN架构"></a>
### 2.3 其他用于年龄估计的CNN架构 Other CNN architectures for age estimation
Chen等人（2017）提出了OR-CNN（Niu等人，2016）的修改版本，称为Ranking-CNN，它使用一组CNN进行二元分类，并汇总预测结果以估计给定人脸图像的年龄标签。研究人员表明，训练一组CNN比训练具有多个二元输出的单个CNN可以提高预测性能（Chen等人，2017），这与一个众所周知的事实一致，即集成模型可以比集合中的每个单独分类器实现更好的泛化性能（Raschka和Mirjalili，2019）。

最近的研究还表明，训练一个多任务CNN，该CNN共享底层参数用于各种面部分析任务（人脸检测、性别预测、年龄估计等），可以提高不同任务之间的整体性能（Ranjan等人，2017）。

另一种利用二元分类器进行序数回归的方法是Polania等人（2019）提出的连体CNN架构，该架构通过输入图像与多个精选的锚点图像之间的配对比较来计算排名。

<a id="3.CORAL"></a>
## 3.CORAL
我们提出的 CORAL 框架旨在解决 Niu 等人（2016）提出的 OR-CNN 中分类器不一致的问题，该框架基于多个用于排名的二元分类任务。

<a id="3.1前置知识"></a>
### 3.1 前置知识 Preliminaries
设  $`  D = \left \{ x_i,y_i \right \}_{i=1}^N  `$ 为由N个训练样本组成的训练数据集。这里，$`x_i \in X`$ 表示第i个训练样本，yi表示相应的排名，其中$`y_i \in Y = {r_1,r_2,...r_K}`$，有序排名 $`r_K > r_{K-1} > r_{1}`$。序数回归任务是找到一个排名规则$`h:X -> Y`$，使得最小化损失函数 $`L(h)`$ 。

设C是一个$`K×K`$的成本矩阵，其中$`C_{y,r_k}`$表示对于将示例(x, y)预测为排名$`r_k`$的成本（Li和Lin，2007）。通常情况下，$`C_{y,y} = 0`$,且对于$`y≠rk`$，$`C_{y,r_k} > 0`$。在有序回归中，我们通常希望成本矩阵的每一行呈V形，即如果$`r_k \le y`$，则$`C_{y,r_{k-1}} \ge  C_{y,r_k}`$，如果$`r_k \ge y`$，则$`C_{y,r_{k}} \le  C_{y,r_{k+1}}`$。分类的成本矩阵中的条目$` C_{y,r_k} = \mathbb{1}\left \{ y \neq r_k \right \} `$不考虑排序信息。在有序回归中，其中排名被视为数值，常用的绝对成本矩阵由$`C_{y,r_k} = \left | y-r_k \right | `$定义。

Li和Lin（2007）提出了一个通用的降维框架，用于将有序回归问题扩展为多个二元分类问题。该框架需要成本矩阵在每一行上都是凸的（对于每个y都有：
$`\left  C_{y,r_{k+1}} - C_{y,r_k} \ge   C_{y,r_k}  - C_{y,r_{k-1}}\right `$），以获得一个排名单调阈值模型。由于每个二元任务的成本加权对每个训练示例都是特定的，这种方法在实践中被认为是不可行的，因为它具有很高的训练复杂性（Niu等，2016）。

我们提出的CORAL框架既不需要成本矩阵具有凸行条件，也不需要依赖于每个训练示例的显式加权项，即可获得一个排名单调的阈值模型，并对每个二元任务产生一致的预测。


<a id="3.2一致性排名logits模型的序数回归"></a>
### 3.2 一致性排名logits模型的序数回归

<a id="4.实验Experiments"></a>
## 4.实验 Experiments

<a id="5.结论Conclusion"></a>
## 5.结论 Conclusion
本文中，我们开发了 CORAL 框架，通过扩展二元分类实现了有序回归，并提供了对分类器一致性的理论保证。此外，我们证明了分类器的一致性，而无需依赖排名或训练标签的加权方案，这使得实现简单且模型训练高效。CORAL 可以方便地应用于扩展常见的卷积神经网络架构，用于有序回归任务。实验证明，CORAL 框架大大提升了在三个独立的年龄估计数据集上基于 CNN 的预测性能。我们的方法可以轻松推广到其他有序回归问题和不同类型的神经网络架构，包括多层感知机和循环神经网络。










